<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mehmetâ€™in ArsasÄ± â€” GÃ¼ncel DeÄŸer</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#111826; --card2:#0e1522; --border:#1d2a3d;
      --text:#e8eef6; --muted:#9aa8c7; --blue:#2b5cff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    body{margin:0;background:var(--bg);color:var(--text)}
    .wrap{max-width:760px;margin:0 auto;padding:26px 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:20px}
    h1{margin:0 0 8px;font-size:22px}
    .sub{color:var(--muted);font-size:13px;line-height:1.45}
    .hero{margin-top:14px;background:var(--card2);border:1px solid var(--border);border-radius:16px;padding:16px}
    .k{color:var(--muted);font-size:12px}
    .v{font-size:34px;font-weight:900;margin:6px 0 0}
    .mini{color:var(--muted);font-size:12px;margin-top:6px;line-height:1.4}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    button{cursor:pointer;border:0;border-radius:12px;padding:10px 12px;font-weight:800}
    .btn{background:var(--blue);color:#fff}
    .btn2{background:transparent;color:var(--text);border:1px solid var(--border)}
    code{background:var(--card2);border:1px solid var(--border);padding:2px 6px;border-radius:8px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Mehmetâ€™in arsasÄ±: â€œBugÃ¼n kaÃ§ para?â€ ğŸ˜„</h1>
      <div class="sub">
        2018â€™de â€œ75.000 TL verdimâ€ demek kolayâ€¦<br>
        Biz iÅŸi duygudan Ã§Ä±karÄ±p <b>468 gram altÄ±n</b> hesabÄ±na baÄŸlÄ±yoruz.
      </div>

      <div class="hero">
        <div class="k" id="status">Veri Ã§ekiliyorâ€¦</div>
        <div class="v" id="value">â€”</div>
        <div class="mini" id="detail">â€”</div>
      </div>

      <div class="row">
        <button class="btn" id="share">WhatsAppâ€™ta paylaÅŸ</button>
        <button class="btn2" id="refresh">Yenile</button>
      </div>

      <div class="mini" id="debug" style="margin-top:10px"></div>
    </div>
  </div>

<script>
  const GRAM = 468;
  const DATA_URL = "./data.json?ts=" + Date.now(); // cache kÄ±r

  const elStatus = document.getElementById("status");
  const elValue  = document.getElementById("value");
  const elDetail = document.getElementById("detail");
  const elDebug  = document.getElementById("debug");

  function fmtTRY(n){
    return n.toLocaleString("tr-TR", { style:"currency", currency:"TRY", maximumFractionDigits:2 });
  }

  async function load(){
    elStatus.textContent = "Veri Ã§ekiliyorâ€¦";
    elValue.textContent = "â€”";
    elDetail.textContent = "â€”";
    elDebug.textContent = "";

    try{
      const r = await fetch(DATA_URL, { cache:"no-store" });
      if (!r.ok) throw new Error("data.json HTTP " + r.status);
      const d = await r.json();

      if (!d.gram_try) throw new Error("gram_try boÅŸ. (Workflow parse/Ã¶lÃ§ek kontrolÃ¼ devreye girmiÅŸ olabilir.)");

      const gram = Number(d.gram_try);
      const total = gram * GRAM;

      elStatus.textContent = "ArsanÄ±n gÃ¼ncel deÄŸeri (468 g altÄ±n)";
      elValue.textContent  = fmtTRY(total);

      const when = d.update_date_raw ? d.update_date_raw : (d.updated_at || "");
      elDetail.textContent = `1 g = ${fmtTRY(gram)} â€¢ GÃ¼ncelleme: ${when} â€¢ Kaynak: ${d.source}`;

      elDebug.textContent = `KÄ±sacasÄ±: â€œ75 bin TLâ€ gÃ¼zel hikÃ¢yeâ€¦ ama bugÃ¼n altÄ±n konuÅŸuyor ğŸ™‚`;
    }catch(e){
      elStatus.textContent = "Veri alÄ±namadÄ±.";
      elDetail.textContent = "Ã‡Ã¶zÃ¼m: GitHub Actions workflow Ã§alÄ±ÅŸmalÄ± ve data.json oluÅŸmalÄ±.";
      elDebug.textContent = String(e && e.message ? e.message : e);
    }
  }

  document.getElementById("refresh").addEventListener("click", load);
  document.getElementById("share").addEventListener("click", () => {
    const msg =
      `Mehmetâ€™in arsasÄ± â€” 468 gram altÄ±n hesabÄ± (gÃ¼ncel):\n${location.href}`;
    window.open("https://wa.me/?text=" + encodeURIComponent(msg), "_blank");
  });

  load();
</script>
</body>
</html>
